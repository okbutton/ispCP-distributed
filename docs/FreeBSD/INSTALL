ispCP ω (OMEGA) HowTo Install for FreeBSD 8.0
================================================================================
For other Linux distributions please check the other INSTALL files.
================================================================================

Table of Content
================
1) Version Info
2) Requirements
3) Introduction
4) Installation
5) Update
6) Uninstall
7) Credits

================================================================================
1) Version Info
---------------
ispCP ω Version	: 1.0.4
INSTALL Script	: 4.3
Maintainer		: Blocker
Homepage		: http://www.isp-contol.net
Distros			: FreeBSD

================================================================================
2) Requirements
---------------
There is no must have for a system using ispCP ω. This is only a recommendation:

Pentium III or K6-4 with 500 MHz
512 MB RAM
100 MB disk space (only for install of ispCP ω)
Debian (or even any other *NIX-Distribution)

All FreeBSD required packages are listed in docs/FreeBSD/freebsd-packages

================================================================================
3) Introduction
---------------
ispCP ω delivers a complete hosting automation appliance by offering significant
security, total-cost-of-ownership, and performance advantages over competing
commercial solutions.

With ispCP ω you can configure your server and applications, create user with
domains with a few point-and-click operations that take less than a minute.
There is no limit to the number of resellers, users and domains that can be
created. The core of ispCP ω are 3 easy-to-use, web-based control panels. ispCP
provides graphic user interfaces for the administrators, resellers and users.

================================================================================
4) Installation
---------------
Make sure you are logged in as root and MySQL is running
and Name Server rndc.key has been setup.

1. Untar or unzip the distribution files to a secure directory:
	# cd /usr/local/src
	# tar xjvf ispcp-omega-1.0.4.tar.bz2

2. Change to the newly created directory:
	# cd ./ispcp-omega-1.0.4

3. Install the required modules
	# cd /usr/ports/ports-mgmt/portmaster
	# make install clean
	# rehash
	# portmaster $(cat ./docs/FreeBSD/freebsd-packages)

	apache 2.2.11_3 Options

	x threads       option
 	x mysql         option
 	x IPV6
 	x BDB
 	x AUTH_BASIC
 	x AUTH_DIGEST
 	x AUTHN_FILE
 	x AUTHN_DBD
 	x AUTHN_DBM
 	x AUTHN_ANON
 	x AUTHN_DEFAULT
 	x AUTHN_ALIAS
 	x AUTHZ_HOST
 	x AUTHZ_GROUPFILE
 	x AUTHZ_USER
 	x AUTHZ_DBM
 	x AUTHZ_OWNER
 	x AUTHZ_DEFAULT
 	x CACHE
 	x DISK_CACHE
 	x FILE_CACHE
 	x ACTIONS
 	x ALIAS
 	x ASIS
 	x AUTOINDEX
 	x CERN_LDAP
 	Y DBD
 	x DEFLATE
 	x DIR
 	x DUMPIO
 	x ENV
 	x EXPIRES
 	x HEADERS
 	x INFO
 	x LOG_CONFIG
 	x LOGIO
 	x MIME
 	x MIME_MAGIC
 	x NEGOTIATION
 	x REWRITE
 	x SETENVIF
 	x SPELING
 	x STATUS
 	x UNIQUE_ID
 	x USERDIR
 	x USERTRACK
 	x VHOST_ALIAS
 	x FILTER
 	x VERSION
 	x PROXY
 	x SSL
 	x SUEXEC

	proftpd 1.3.2 Options

	x CTRLS
	x IFSESSION
	x IPV6
	x MYSQL
	x NLS
	x OPENSSL
	x QUOTA
	x RATIO
	x README
	x REWRITE
	x WRAP

	courier-imap 4.4.1,2 Options

	x IPV6
	x AUTH_MYQL
	x AUTH_USERDB

	courier-authlib 0.62.1 Options

	x AUTH_MYQL
	x AUTH_USERDB

	Perl Options

	+ Compress-Zlib
 	+ Crypt-Blowfish
	+ Crypt-CBC
	+ Crypt-DES
	+ Crypt-PasswdMD5
	+ Crypt-SSLeay
	+ DBD-mysql
	+ DBI
	+ Digest-HMAC
	+ Digest-SHA1
	+ HTML-Parser
	+ HTML-Tagset
	+ HTTP-GHTTP
	+ IO-stringy
	+ libwww
	+ MIME-tools
	+ Mail-Tools
	+ Net-DNS
	+ Net-Daemon
	+ Net-IP
	+ Net-LibIDN
	+ PlRPC
	+ URI
	+ Term-ReadPassword
	
	postfix 2.5.6,1 Options
	
	x PCRE
	
	p5-Net-DNS 0.65 Options
	
	x IPV6

	PHP5 5.2.8 Options

	x CLI
	x CGI
	x APACHE
	x SUHOSIN
	x IPV6
	x FASTCGI
	x PATHINFO	

	PHP5-Extensions 1.2 Options

	x BZ2
	x CTYPE
	x CURL
	x DBA
	x DOM
	x FILEINFO
	x FILTER
	x FTP
	x GD
	x HASH
	x ICONV
	x IMAP
	x JSON
	x MBSTRING
	x MCRYPT
	x MHASH
	x MYSQL
	x PDO
	x PDO_SQLITE
	x POSIX
	x SESSION
	x SHMOP
	x SIMPLEXML
	x SOAP
	x SOCKET
	x SPL
	x SQLITE
	x TOKENIZER
	x XML
	x XMLREADER
	x XMLRPC
	x XMLWRITER
	x ZIP

4. Configure the system.
	# cpan upgrade
	# cpan DBI DBD::mysql MIME::Entity MIME::Parser Crypt::CBC Crypt::Blowfish Crypt::PasswdMD5 Term::ReadPassword

    Edit /etc/rc.conf and add

	proftpd_enable="YES"
	mysql_enable="YES"
	apache22_http_accept_enable="YES"
	apache22_enable="YES"
	courier_authdaemond_enable="YES"
	courier_imap_imapd_enable="YES"
	courier_imap_imapd_ssl_enable="NO"
	courier_imap_pop3d_enable="YES"
	courier_imap_pop3d_ssl_enable="YES"
	
	postfix_enable="YES"
	policyd_weight_enable="YES"
	postgrey_enable="YES"
	spamd_enable="YES"
	
	# Disable because of Postfix.
	sendmail_enable="NO"
	sendmail_submit_enable="NO"
	sendmail_outbound_enable="NO"
	sendmail_msp_queue_enable="NO"

4. (optional) Check the ispcp.conf and adapt it to your requirements.

5. Build the System by using make:
	# make -f Makefile.fbsd install

6. Copy all the directories into your system (you may make backups)
	# cp -Rv /tmp/ispcp/* /

7. Now it's time to set up the frontend. Change into the engine directory:
	# cd /usr/local/www/ispcp/engine/setup

8. Configure the MySQL Server and set the MySQL password, if not set:
	# /usr/local/bin/mysql_install_db
	# chown -R mysql /var/db/mysql/
	# /usr/local/etc/rc.d/mysql-server start
	# mysqladmin -u root password 'YOUR_PASSWORD'

9. Start the engine setup:
	# perl ./ispcp-setup

10. Install ispCP ω step-by-step

	If you get no error, all went good; if you get one, look at
	http://isp-control.net to solve the problem.

11. Clean the temporary folders:
	# rm -fR /tmp/ispcp

12. Load Apache modules
    Edit /usr/local/etc/apache22/httpd.conf and add for FCGId:
	LoadModule fcgid_module libexec/apache22/mod_fcgid.so
	Include etc/apache22/extra/fcgid_ispcp.conf

    or for FastCGI:
	LoadModule fcgid_module libexec/apache22/mod_fastcgi.so
	Include etc/apache22/extra/fastcgi_ispcp.conf
	
	Add a '#' to the php5_module:
	# LoadModule php5_module libexec/apache22/libphp5.so
	
13. Log into ispCP and change 
	"Settings"->"Server Ports" "POSTGREY Port" to 10023.
	
14. Change smtpd.conf
	File /usr/local/etc/sasl2/smtpd.conf must look like:
	pwcheck_method: auxprop
	auxprop_plugin: sasldb
	mech_list: PLAIN LOGIN CRAM-MD5 DIGEST-MD5

	If postfix runs chrooted, you'll have to set a link to 
	/var/spool/postfix/usr/local/etc/sasldb2.db

WARNING:
	DEFAULT setting is using mod_php not fastcgi or mod_fcgid !!
    The configuration is customised for use with apache 2.2.x version using
    suexec module enable.
UNDER JAIL:
    Don't forget to modified postfix, prepared for chroot system for mod_fcgid,
    at master /etc/rc.conf, set jail_sysvipc_allow to YES

================================================================================
5) Update
---------
NOTE: ispCP ω can only be updated from post 1.0.0. If you have a
version prior 1.0.0 (final release) installed, update to ispCP ω 1.0.0 first.

Make sure you are logged in as root and MySQL is running.

1. Untar or unzip the distribution files to a secure directory:
	# cd /usr/local/src
	# tar xjvf ispcp-omega-1.0.4.tar.bz2

2. Change to the newly created directory:
	# cd ./ispcp-omega-1.0.4

3. Install the required modules
   see: ./docs/FreeBSD/freebsd-packages

4. (optional) Check the ispcp.conf and adapt it to your requirements.

5. Stop the ispcp_deamon and build the System by using make:
	# /etc/init.d/ispcp_daemon stop
	# make -f Makefile.fbsd install

6.Backup files
	# cp -v /usr/local/www/ispcp/engine/ispcp-db-keys.pl /tmp/ispcp/usr/local/www/ispcp/engine/
	# cp -v /usr/local/www/ispcp/engine/messenger/ispcp-db-keys.pl /tmp/ispcp/usr/local/www/ispcp/engine/messenger/
	# cp -v /usr/local/www/ispcp/gui/include/ispcp-db-keys.php /tmp/ispcp/usr/local/www/ispcp/gui/include/
	# cp -v /var/www/ispcp/gui/themes/user_logos/* /tmp/ispcp/var/www/ispcp/gui/themes/user_logos/
	# cp -v /usr/local/www/ispcp/gui/tools/pma/config.inc.php /tmp/ispcp/usr/local/www/ispcp/gui/tools/pma/
	# cp -v /var/www/ispcp/gui/tools/webmail/data/* /tmp/ispcp/var/www/ispcp/gui/tools/webmail/data/

7. Delete old files to avoid security risks:
	# rm -fR /usr/local/www/ispcp/gui/admin/
	# rm -fR /usr/local/www/ispcp/gui/client/
	# rm -fR /usr/local/www/ispcp/gui/include/
	# rm -fR /usr/local/www/ispcp/gui/orderpanel/
	# rm -fR /usr/local/www/ispcp/gui/themes/
	# rm -fR /usr/local/www/ispcp/gui/reseller/
	# rm -f /usr/local/www/ispcp/gui/*.php

8. Copy /usr and /var directories into your system (you may make backups)
	# cp -Rv /tmp/ispcp/usr/* /usr/
	# cp -Rv /tmp/ispcp/var/* /var/

9. Backup ispcp.conf and copy the /etc directory into your system (you may make backups):
	# mv -v /etc/ispcp/ispcp.conf /etc/ispcp/ispcp.old.conf
	# cp -Rv /tmp/ispcp/etc/* /etc/

10. Now it's time to update your installation. Change into the engine directory:
	# cd /var/www/ispcp/engine/setup

11. Start the engine update:
	# perl ispcp-update

12. Update ispCP ω step-by-step

	If you get no error, all went good; if you get one, look at
	http://isp-control.net to solve the problem.

13. Clean the temporary folders:
	# rm -fR /tmp/ispcp/

================================================================================
6) Uninstall
------------
Make sure you are logged in as root and MySQL is running.

1. Change into the engine directory:
	# cd /usr/local/www/ispcp/engine/setup

2. Start the uninstall script:
	# perl ispcp-uninstall

3. Clean up your system

================================================================================
7) Credits
----------

ispCP ω is a project of ispCP | isp Control Panel.
ispCP, ispCP ω, isp Control Panel, the ispCP logo and the ω Logo are trademarks
of the ispCP | isp Control Panel Project Team.

Please visit our site under http://isp-control.net for further information on
ispCP ω, ispCP and other themes.

We hope you enjoy using ispCP ω. If you like it, help us, to make it better. We
would be glad on any help provided!
