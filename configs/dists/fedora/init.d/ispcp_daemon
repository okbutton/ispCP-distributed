#!/bin/sh

# ispCP Ï‰ (OMEGA) a Virtual Hosting Control System
# Copyright (c) 2007 by ispCP
# http://www.isp-control.net
#
#
# License:
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of the MPL Mozilla Public License
#    as published by the Free Software Foundation; either version 1.1
#    of the License, or (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    MPL Mozilla Public License for more details.
#
#    You may have received a copy of the MPL Mozilla Public License
#    along with this program.
#
#    An on-line copy of the MPL Mozilla Public License can be found
#    http://www.mozilla.org/MPL/MPL-1.1.html
#
#
# The ispCP Home Page is at:
#
#    http://www.isp-control.net

# Source function library.
. /etc/rc.d/init.d/functions

prog=ispcp_daemon
progpath=/var/www/ispcp/daemon
lockfile=/var/lock/subsys/ispcp
PID=/var/run/ispcp_daemon.pid

start() {
        echo -n $"Starting $prog: "
        daemon $progpath/$prog -p $PID
        RETVAL=$?
        [ $RETVAL -eq 0 ] && touch $lockfile >/dev/null 2>&1
        echo
}

stop() {
        echo -n $"Shutting down $prog: "
        killproc $prog
        RETVAL=$?
        echo
        [ $RETVAL -eq 0 ] && rm -f $lockfile
}

status() {
		if [ -s $pidfile ]; then
			pid=`cat $pidfile`
			kill -0 $pid >/dev/null 2>&1
			if [ "$?" = "0" ]; then
				echo "$prog (pid $pid) is running"
				RETVAL=0
			else
				echo "$prog is stopped"
				RETVAL=1
			fi
		else
			echo "$prog is stopped"
			RETVAL=1
		fi
}

case "$1" in
  start)
        start
		/etc/init.d/ispcp_network
	;;
  stop)
        stop
	;;
  restart)
        stop
        start
	;;
  status)
        status $prog
        RETVAL=$?
	;;
  *)
        echo "Usage: $prog {start|stop|restart|status}"
	exit 1
esac

exit $RETVAL