#! /bin/sh

# ispCP Ï‰ (OMEGA) a Virtual Hosting Control System
# Copyright (c) 2007 by ispCP
# http://www.isp-control.net
#
#
# License:
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of the MPL Mozilla Public License
#    as published by the Free Software Foundation; either version 1.1
#    of the License, or (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    MPL Mozilla Public License for more details.
#
#    You may have received a copy of the MPL Mozilla Public License
#    along with this program.
#
#    An on-line copy of the MPL Mozilla Public License can be found
#    http://www.mozilla.org/MPL/MPL-1.1.html
#
#
# The ispCP Home Page is at:
#
#    http://www.isp-control.net

set -e

# Note: do not modify any of these vars here, use /etc/default/$NAME instead

PATH=/sbin:/bin:/usr/sbin:/usr/bin
NAME=ispcp_daemon
DAEMON=/var/www/ispcp/daemon/$NAME
PID=/var/run/$NAME.pid
DESC="ispCP Daemon"

START=1

test -f $DAEMON || exit 0

# Read config file if it is present.
if [ -r /etc/default/$NAME ]; then
	. /etc/default/$NAME
fi

if [ $START -eq 0 ]; then
	echo "$DESC: not starting, edit /etc/default/$NAME."
	exit 0
fi

case "$1" in
  start)
    echo "Starting $DESC..."
	start-stop-daemon --start --verbose --exec $DAEMON -- -p $PID
	;;
  stop)
	start-stop-daemon --stop --verbose --pidfile $PID --exec $DAEMON --retry 5
    rm $PID
	;;
  restart|force-reload)
	start-stop-daemon --stop --verbose --pidfile $PID --exec $DAEMON --retry 5
	rm $PID
    echo "Starting $DESC..."
	start-stop-daemon --start --verbose --exec $DAEMON -- -p $PID
	;;
  status)
    set +e
    if [ -s $PID ]; then
        RPID=`cat $PID`
        kill -0 $RPID 2> /dev/null
        if [ "$?" = 0 ] ; then
            echo "$NAME is started"
            exit 0
        fi
    fi
    echo "$NAME is stopped"
    exit 1
	;;
  *)
	N=/etc/init.d/$NAME
	echo "Usage: $N {start|stop|restart|force-reload|status}" >&2
	exit 1
	;;
esac

exit 0
